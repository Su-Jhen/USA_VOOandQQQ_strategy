# 📊 VOO/QQQ 動態配置策略詳細規劃

## 🎯 策略核心邏輯
- **下跌期**：QQQ跌幅 > VOO跌幅 → 增加QQQ配置（買入便宜的高Beta資產）
- **上漲期**：QQQ漲幅 > VOO漲幅 → 減少QQQ配置（實現超額收益，轉入穩定資產）

---

## 📈 策略 A：趨勢均線交叉法（MA Crossover）

### 基本版本
```python
信號產生：使用VOO價格計算
- 下跌信號：MA_fast < MA_slow（死叉）
- 上漲信號：MA_fast > MA_slow（金叉）
```

### 參數矩陣
| 參數組合 | MA_fast | MA_slow | 說明 |
|---------|---------|---------|------|
| 超短期 | 10 | 30 | 敏感度高，交易頻繁 |
| 短期 | 20 | 50 | 短線交易常用 |
| 中期 | 50 | 100 | 平衡版本 |
| **經典** | **50** | **200** | **黃金交叉/死亡交叉** |
| 長期 | 100 | 200 | 長線趨勢 |

### 進階優化
1. **雙重確認機制**
   ```
   下跌確認：MA_fast < MA_slow AND MA_slow斜率 < 0
   上漲確認：MA_fast > MA_slow AND MA_slow斜率 > 0
   ```

2. **交叉強度過濾**
   ```
   有效交叉：(MA_fast - MA_slow) / MA_slow > threshold（如1%）
   避免微小交叉產生過多信號
   ```

3. **持續時間確認**
   ```
   信號確認：交叉後需維持N日（如3日）才執行
   避免假突破
   ```

### 配置規則
```python
IF 下跌信號:
    QQQ權重 = min(50%, 基礎權重 + 下跌深度調整)
    VOO權重 = 100% - QQQ權重
ELIF 上漲信號:
    QQQ權重 = 0%
    VOO權重 = 100%
```

---

## 🚀 策略 B：價格突破法（Donchian Channel）

### 基本版本
```python
信號產生：使用VOO價格
- 下跌信號：Close < N日最低價
- 上漲信號：Close > N日最高價
```

### 參數矩陣
| 週期 | N值 | 交易頻率 | 適用市況 |
|------|-----|---------|---------|
| 月度 | 20 | 高 | 震盪市 |
| 季度 | 63 | 中 | 趨勢市 |
| 半年 | 126 | 低 | 強趨勢 |
| 年度 | 252 | 極低 | 長期趨勢 |

### 進階優化
1. **突破確認帶**
   ```
   下跌確認：Close < N日最低 * 0.98（2%緩衝）
   上漲確認：Close > N日最高 * 1.02（2%緩衝）
   ```

2. **動態通道寬度**
   ```
   通道寬度 = (N日最高 - N日最低) / N日最低
   寬通道（>10%）：提高突破門檻
   窄通道（<5%）：降低突破門檻
   ```

3. **成交量確認**
   ```
   有效突破：突破日成交量 > 20日平均成交量 * 1.5
   ```

### 配置規則
```python
IF 向下突破:
    QQQ權重 = 30% + 20% * (突破幅度/5%)  # 最高50%
ELIF 向上突破:
    QQQ權重 = max(0%, 20% - 20% * (突破幅度/5%))  # 逐步減少
ELSE:  # 盤整期
    維持現有配置
```

---

## 📉 策略 C：回撤門檻法（Drawdown Threshold）

### 基本版本
```python
信號產生：計算VOO的滾動回撤
回撤 = (滾動最高價 - 當前價) / 滾動最高價
- 下跌信號：回撤 >= θ%
- 上漲信號：創新高 OR 回撤 < θ_recovery%
```

### 參數矩陣
| 級別 | θ下跌門檻 | θ_recovery恢復門檻 | 風險偏好 |
|------|----------|-------------------|----------|
| 保守 | 5% | 2% | 低風險 |
| 穩健 | 8% | 4% | 中風險 |
| **標準** | **10%** | **5%** | **平衡** |
| 積極 | 15% | 7% | 高風險 |
| 激進 | 20% | 10% | 極高風險 |

### 進階優化
1. **分級響應機制**
   ```python
   回撤 5-10%：QQQ權重 = 20%
   回撤 10-15%：QQQ權重 = 35%
   回撤 >15%：QQQ權重 = 50%
   ```

2. **回撤速度考量**
   ```python
   快速回撤（5日內）：權重調整 * 1.2
   緩慢回撤（20日以上）：權重調整 * 0.8
   ```

3. **相對回撤比較**
   ```python
   IF VOO回撤 > QQQ回撤:
       減少QQQ配置（防守）
   ELIF QQQ回撤 > VOO回撤 * 1.5:
       增加QQQ配置（機會）
   ```

### 配置規則
```python
# 動態配置基於回撤深度
QQQ基礎權重 = min(50%, 回撤% * 3)
# 根據回撤速度調整
QQQ最終權重 = QQQ基礎權重 * 速度因子
```

---

## 📊 策略 D：波動度適應法（Volatility-Based）

### 基本版本
```python
信號產生：計算VOO的滾動波動率
波動率 = 20日收益率標準差 * sqrt(252)
Z分數 = (當前波動率 - 60日均值) / 60日標準差
- 高波動（下跌）：Z分數 > 1.0
- 低波動（上漲）：Z分數 < -0.5
```

### 參數矩陣
| 參數組 | 短期窗口 | 長期窗口 | Z門檻 | 說明 |
|--------|---------|---------|-------|------|
| 敏感 | 10 | 30 | 0.5 | 快速反應 |
| 標準 | 20 | 60 | 1.0 | 平衡 |
| 穩定 | 30 | 90 | 1.5 | 過濾噪音 |

### 進階優化
1. **GARCH波動預測**
   ```python
   使用GARCH(1,1)模型預測未來波動
   IF 預測波動 > 實現波動 * 1.2:
       增加防守（增加QQQ）
   ```

2. **相對波動率（QQQ/VOO）**
   ```python
   相對波動 = QQQ波動率 / VOO波動率
   IF 相對波動 > 歷史80%分位:
       QQQ權重 = 50%  # QQQ特別不穩定
   ELIF 相對波動 < 歷史20%分位:
       QQQ權重 = 20%  # QQQ相對穩定
   ```

3. **VIX參考（如可獲得）**
   ```python
   IF VIX > 30:  # 恐慌
       QQQ權重 = 50%
   ELIF VIX < 15:  # 貪婪
       QQQ權重 = 0%
   ```

### 配置規則
```python
# 基於波動率Z分數的連續調整
QQQ權重 = 25% + 15% * tanh(Z分數)  # 範圍約10%-40%
# 極端情況限制
IF Z分數 > 2: QQQ權重 = 50%
IF Z分數 < -1: QQQ權重 = 0%
```

---

## 💪 策略 E：相對強弱確認法（Relative Strength）

### 基本版本
```python
信號產生：計算QQQ/VOO比率
RS = QQQ價格 / VOO價格
RS_MA = RS的20日移動平均
- QQQ轉強：RS > RS_MA * 1.02
- QQQ轉弱：RS < RS_MA * 0.98
```

### 參數矩陣
| 參數 | MA週期 | 突破門檻 | 用途 |
|------|--------|---------|------|
| 短期 | 10 | 1% | 動量追蹤 |
| 中期 | 20 | 2% | 趨勢確認 |
| 長期 | 50 | 3% | 主趨勢 |

### 進階優化
1. **雙重RS確認**
   ```python
   主信號：VOO的趨勢（MA交叉）
   確認信號：QQQ/VOO相對強度

   IF VOO下跌 AND QQQ相對轉強:
       QQQ權重 = 50%  # 最佳買入時機
   ELIF VOO下跌 AND QQQ相對轉弱:
       QQQ權重 = 20%  # 謹慎配置
   ELIF VOO上漲 AND QQQ相對轉強:
       QQQ權重 = 10%  # 部分參與
   ELIF VOO上漲 AND QQQ相對轉弱:
       QQQ權重 = 0%   # 完全退出
   ```

2. **RS動量評分**
   ```python
   RS_動量 = (RS_now - RS_20日前) / RS_20日前
   動量評分 = rank(RS_動量, 過去252日)

   IF 動量評分 > 80%:
       增加QQQ配置
   ELIF 動量評分 < 20%:
       減少QQQ配置
   ```

3. **板塊輪動考量**
   ```python
   # 科技股週期判斷
   IF RS > 過去2年75%分位:
       科技股過熱，減少QQQ
   ELIF RS < 過去2年25%分位:
       科技股超賣，增加QQQ
   ```

### 配置規則
```python
# 基礎配置（根據VOO趨勢）
IF VOO下跌:
    基礎QQQ = 35%
ELSE:
    基礎QQQ = 10%

# RS調整因子
IF QQQ相對強:
    最終QQQ = min(50%, 基礎QQQ * 1.5)
ELSE:
    最終QQQ = max(0%, 基礎QQQ * 0.5)
```

---

## 🔄 綜合策略框架

### 多信號融合方案
```python
# 各策略權重投票
MA信號權重 = 30%
突破信號權重 = 20%
回撤信號權重 = 20%
波動信號權重 = 15%
RS信號權重 = 15%

# 綜合評分
綜合信號 = Σ(各信號 * 權重)

# 最終配置
IF 綜合信號 > 0.6:
    QQQ = 50%  # 強烈看跌
ELIF 綜合信號 > 0.3:
    QQQ = 30%  # 溫和看跌
ELIF 綜合信號 < -0.3:
    QQQ = 0%   # 看漲
ELSE:
    QQQ = 15%  # 中性
```

### 風險管理層
1. **最大配置限制**：QQQ不超過50%
2. **再平衡頻率**：最短5個交易日
3. **交易成本考量**：變動超過5%才調整
4. **極端市場保護**：單日跌幅>5%時暫停交易

---

## 📊 回測實施建議

### 優先級排序
1. **第一優先**：策略A（MA交叉）- 最經典可靠
2. **第二優先**：策略C（回撤門檻）- 直觀有效
3. **第三優先**：策略E（相對強弱）- 捕捉輪動
4. **第四優先**：策略B（價格突破）- 趨勢跟隨
5. **第五優先**：策略D（波動度）- 風險管理

### 參數優化建議
- 使用2010-2018數據進行參數優化
- 使用2019-2022數據進行驗證
- 使用2023-2025數據進行樣本外測試

### 評估維度
1. **絕對收益**：CAGR
2. **風險調整收益**：夏普比率、Sortino比率
3. **回撤控制**：最大回撤、平均回撤
4. **交易效率**：換手率、交易成本占比
5. **穩定性**：各年度表現、勝率

---

## 🎯 實施路線圖

### Phase 1：基礎建設（第1週）
- 數據準備與清理
- 回測框架搭建
- 基礎指標計算

### Phase 2：單策略測試（第2週）
- 實施策略A（MA交叉）
- 參數掃描與優化
- 生成回測報告

### Phase 3：全策略實施（第3週）
- 實施策略B-E
- 比較各策略表現
- 找出最優組合

### Phase 4：綜合優化（第4週）
- 多策略融合測試
- 風險管理層實施
- 最終報告生成

---

**最後更新**：2025-09-13
**下一步**：開始實施策略A（MA交叉法）