目標與概要

以年初定期加碼（2011 年首個交易日投入 10,000 美元，之後每年首個交易日加碼 3,000 美元）為前提，設計並回測三種策略：

只持有 VOO（買入後長期持有 + 年初加碼）。

只持有 QQQ（買入後長期持有 + 年初加碼）。

動態在 VOO 與 QQQ 之間調整：以「市場進入下跌/上漲」作為開關，在下跌期提高 QQQ（至多 50%），在上漲期回到 VOO（QQQ 目標 0%）。

你提供的核心想法我具體化為可測試的信號/規則族群、資金流邏輯、交易執行框架、與評估指標，形成一個可重複、可調參的回測計畫。

數據與一般假設

標的：VOO、QQQ（忽略配息）。

頻率：使用日資料

樣本期：2011 年第一個美股交易日至資料可得最近交易日。

交易成本：每次交易 (買或賣以每筆3美元的手續費計算)

交易價格: 以當日收盤價當作交易價格

稅務：不考慮（回測與跨司法轄區稅制差異大）。

時區/交易日：以美東市場交易日為準；每年「首個交易日」按美股行事曆計算。

年初加碼與持倉會計

2011 年首個交易日：投入 $10,000，依當天策略目標權重下單。

2012 起每年的首個交易日：投入 $3,000，先將現金注入組合，再按「當日（或訊號延遲後）目標權重」一併再平衡。

現金管理：不保留閒置現金（除非再平衡公差讓少量現金殘留，視為現金持有報酬 0）。

下單時點：為避免前視偏誤，訊號以 t 日收盤產生，t+1 以目標權重成交（以 t+1 調整收盤近似執行；回測引擎會做一根 K 的延遲）。

「市場開始下跌/上漲」的可測試訊號族群

動態策略只需要二元狀態：Down（下跌期） 或 Up（上漲期）。以下列出基準版本與替代/敏感度版本。

A. 趨勢均線法（基準版本）

定義：以 VOO 為市場代理；若 MA_fast < MA_slow → Down，反之 Up。

參數網格：

MA_fast ∈ {20, 50, 63, 84}

MA_slow ∈ {100, 150, 200, 252}

可加入斜率過濾：d(MA_slow)/dt < 0 才承認 Down（避免假跌）。

B. 價格突破/區間法（Donchian/HH-LL）

定義：Close < N日低點 → Down；Close > N日高點 → Up。

參數：N ∈ {40, 63, 84, 126}；可加回補帶（如突破後需持續 M 日才確認）。

C. 回撤（Drawdown）門檻法

定義：以 VOO 滾動峰值計算回撤 DD = (Peak - Close)/Peak；若 DD ≥ θ% → Down；當 Close 創新高或 DD < θ_low% → Up。

參數：θ ∈ {5, 8, 10, 12, 15}；θ_low 可取 θ/2 或 0。

D. 波動度/壓力法

定義：用 VOO 的年化實現波動（如 20/60 日）或 ATR；若波動度的 z-score 高於門檻 → Down，低於門檻 → Up。

參數：窗長 W ∈ {20, 60}；門檻 z ∈ {0.5, 1.0, 1.5}。

E. 相對強弱確認（可選輔助）

定義：在 Down 狀態下，僅當 QQQ/VOO 比率 上行（如比率 > 其 50 日均線）才把 QQQ 提到上限；否則保守只持有 VOO 或把 QQQ 權重降至 25%。

建議基準：採 A. 趨勢均線（50 / 200）+ 一根 K 的交易延遲，搭配 2% 目標權重公差（避免過度再平衡）。

持倉與再平衡規則（動態策略）

狀態與目標權重：

Up：w_QQQ* = 0%，w_VOO* = 100%。

Down：w_QQQ* = min(50%, w_cap)，w_VOO* = 100% - w_QQQ*。

上限：w_cap = 50%（你指定）。

調整節奏：

即時跳轉（基準）：訊號翻轉次一交易日一次性調整至目標權重。

分段進出（敏感度）：於 Down 狀態下，先調至 25%，若 Down 連續 M 日或回撤加深再升至 50%；回到 Up 時一次清空 QQQ。

再平衡公差：若實際權重距目標 < τ（如 2%），則不交易；加碼日不受此限（可選）。

加碼優先順序：年初注資後，先把資金用於補足至目標權重，其餘才平均分配（通常不會剩）。

基準策略定義（作為比較）

VOO Buy&Hold：年初加碼後全部買進 VOO，期間不賣、不再平衡。

QQQ Buy&Hold：年初加碼後全部買進 QQQ，期間不賣、不再平衡。

三策略均以調整收盤價推進，等同股息自動再投資。

風險控管與停損（可選測試）

極端日保護：單日跌幅 > X%（如 6%）且處於 Down 時，將 QQQ 降至 25% 或 0%。

波動目標：以 20/60 日年化波動估算槓桿/去槓桿（本案不使用槓桿，只做權重微調）。

交易冷卻期：訊號翻轉後 K 日內不接受反向翻轉，K ∈ {3, 5, 10}，避免震盪來回。

評估指標（報表）

累積資產淨值曲線、回撤曲線（Underwater）。

年化報酬（CAGR）、年化波動、夏普（rf=0 或 3M T-bill 近似）、索提諾、最大回撤、Calmar、Ulcer 指數。

交易統計：交易次數、換手率、平均持有期、滑價/成本影響。

資金注入效果：加碼日的「時機貢獻」分析（在低點附近加碼的次數/比例）。

年度表現表：各年收益、勝率、最差月份/季度。

靈敏度熱圖：不同參數（如 MA_fast/MA_slow、τ、成本）下的 CAGR / MDD / 夏普。

穩健性與偏誤檢查

前視偏誤：所有交易以一日延遲執行；訊號僅用已知資料。

過度優化：

以寬鬆網格做參數掃描，選出一組「合理區間皆穩定」的參數，而非單點最佳。

走勢外推：將 2011–2016、2017–2020、2021–至今做分段測試；或採「擺動窗」Walk-Forward。

起始日敏感度：把首筆 10,000 與年初 3,000 的日子各向後平移 1–10 個交易日重跑，觀察穩定度。

成本敏感度：0/2/5/10 bps 對結果的彈性。

成功判準（Decision Rules）

主要：動態策略相對兩個 Buy&Hold 至少滿足其一：

更高的 Calmar 或 Sortino（風險校正優於被動）。

最大回撤更小且 CAGR 不低於較差的一個被動基準（VOO/QQQ 之中較差者）。

次要：在熊市/高波動窗口（如 2011、2015-16、2018 Q4、2020、2022）具明顯防守/回升優勢。